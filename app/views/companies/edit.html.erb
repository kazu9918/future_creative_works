<html lang="ja">
    <head>
        <title>企業編集画面</title>
        <!-- スタイルとJavaScriptは省略 -->
    </head>
    <body>
        <div class="card card-body">
            <h1>企業編集</h1>
        </div>
        <div class="container">
            <%= form_with(model: @company, local: true) do |form| %>
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td>企業名</td>
                        <td><%= form.text_field :name, class: 'form-control' %></td>
                    </tr>
                    <tr>
                        <td>業界</td>
                        <td>
                        <%= form.collection_select :industry_id, @industries, :id, :category, {include_blank: '選択'}, {class: 'form-control'} %>
                        </td>
                    </tr>
                    <tr>
                        <td>従業員数</td>
                        <td>
                        <div class="input-group" style="max-width: 200px;">
                            <%= form.text_field :number_of_employees, class: 'form-control' %>
                            <span class="input-group-text">人</span>
                        </div>
                        </td>
                    </tr>
                    <tr>
                        <td>部署</td>
                        <td id="departmentInputCell">
                            <% @departments.each_with_index do |department, index| %>
                                <div class="input-group mb-2">
                                    <%= form.fields_for :departments, department, index: index do |department_form| %>
                                        <%= department_form.text_field :name, class: 'form-control' %>
                                    <% end %>
                                    <button class="btn btn-danger btn-sm input-group-append" type="button" onclick="removeField(this)">削除</button>
                                </div>
                            <% end %>
                            <button class="btn btn-outline-secondary" type="button" id="addDepartmentInput">＋ 部署を追加</button>
                        </td>
                    </tr>
                    <tr>
                        <td>業務内容</td>
                        <td id="jobFunctionsInputCell">
                            <% @jobFunctions.each_with_index do |job_function, index| %>
                                <div class="input-group mb-2">
                                    <%= form.fields_for :job_functions, job_function, index: index do |job_function_form| %>
                                        <%= job_function_form.text_field :description, class: 'form-control' %>
                                    <% end %>
                                    <button class="btn btn-danger btn-sm input-group-append" type="button" onclick="removeField(this)">削除</button>
                                </div>
                            <% end %>
                            <button class="btn btn-outline-secondary" type="button" id="addJobFunctionsInput">＋ 業務内容を追加</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="actions d-flex justify-content-center">
                    <%= form.submit '更新', class: 'btn btn-primary', style: 'margin-right: 8px;' %>
                    <%= link_to 'キャンセル', companies_path, class: 'btn btn-secondary' %>
                </div>
            <% end %>
        </div>
    </body>
</html>

    <script>
        // DOMContentLoaded イベントのリスナー
        document.addEventListener('DOMContentLoaded', function() {
            // 初期値を設定
            setInitialValues();

            var addDepartmentInputButton = document.getElementById('addDepartmentInput');
            var addJobFunctionsInputButton = document.getElementById('addJobFunctionsInput');
            var addEmploymentTypesInputButton = document.getElementById('addEmploymentTypesInput');

            addDepartmentInputButton.addEventListener('click', function() {
                addInput('departmentInputCell');
            });

            addJobFunctionsInputButton.addEventListener('click', function() {
                addInput('jobFunctionsInputCell');
            });

            addEmploymentTypesInputButton.addEventListener('click', function() {
                addInput('employmentTypesInputCell');
            });

            function addInput(cellId) {
                var cell = document.getElementById(cellId);

                var inputGroup = document.createElement('div');
                inputGroup.classList.add('input-group');

                var inputField = document.createElement('input');
                inputField.classList.add('form-control');
                inputField.setAttribute('type', 'text');

                var appendDiv = document.createElement('div');
                appendDiv.classList.add('input-group-append');

                var removeButton = document.createElement('button');
                removeButton.classList.add('btn', 'btn-outline-secondary');
                removeButton.setAttribute('type', 'button');
                removeButton.textContent = '−';

                appendDiv.appendChild(removeButton);
                inputGroup.appendChild(inputField);
                inputGroup.appendChild(appendDiv);
                cell.appendChild(inputGroup);

                // ボタンを押すと、追加された入力フィールドを削除する
                removeButton.addEventListener('click', function() {
                    inputGroup.remove();
                });
            }
        });
    </script>
</body>
</html>
